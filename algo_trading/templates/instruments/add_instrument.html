{% extends "base.html" %}

{% load django_bootstrap5 %}

{% block content %}
  <form action={% url "add-instrument" %} method="POST">
    {% csrf_token %}
    <h3>Enter one or more symbols that you wan't to import</h3>

    <label for="{{ form.symbol.id_for_label }}" class="form-label">{{ form.symbol.label }}</label>

    <div class="input-group input-group-lg mb-5">
        <span class="input-group-text" id="basic-addon1">@</span>
        <input
          type="text"
          name="{{ form.symbol.html_name }}"
          class="form-control"
          id="{{ form.symbol.id_for_label }}"
          aria-describedby="basic-addon1"
          placeholder="Comma separated symbols for import"
          required
        />
    </div>
    {% bootstrap_button "Fetch &amp; Validate Symbols" button_type="submit" button_class="btn-primary" %}

  </form>

  {% if symbols_import_summary|length > 0 %}
    {% if symbols_import_summary.failed|length > 0 %}
      <div>
        <p class="header">List of symbols that failed to import</p>
          <table class="failed-symbols table rounded table-striped border gy-7 gs-7">
            <thead>
              <tr>
                <th>#</th>
                <th>Symbol</th>
                <th>Failure reason</th>
              </tr>
            </thead>

            <tbody>
              {% for failed_sym in symbols_import_summary.failed %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ failed_sym.symbol }}</td>
                  <td>{{ failed_sym.reason }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
      </div>
    {% endif %}

    {% if symbols_import_summary.created|length > 0 %}
      <div>
        <p class="header">Successfully imported symbols</p>
        {% include "instruments/display_meta_in_table.html" with instruments=symbols_import_summary.created %}
    </div>
    {% endif %}
  {% endif %}
{% endblock %}
